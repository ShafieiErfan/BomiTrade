<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>جزئیات معامله - بومی‌ترید</title>
    <style>
        @font-face {
            font-family: 'Estedad';
            src: url('fonts/Estedad-Black.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --input-bg: #2c2c2c;
            --text-main: #e0e0e0;
            --text-muted: #a0a0a0;
            --accent: #d4af37;
            --success: #00c853;
            --danger: #ff3d00;
            --border-radius: 12px;
        }
        * { box-sizing: border-box; outline: none; }
        body {
            font-family: 'Estedad', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        /* هدر */
        header {
            position: fixed; top: 0; width: 100%; z-index: 1000; padding: 20px 0; transition: 0.4s; background: transparent;
        }
        header.scrolled {
            background: rgba(18, 18, 18, 0.95); backdrop-filter: blur(12px); border-bottom: 1px solid #333; padding: 10px 0;
        }
        .nav-container { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; padding: 0 20px; }
        .logo { font-size: 1.8rem; font-weight: bold; color: var(--accent); text-decoration: none; display: flex; align-items: center; gap: 10px; }
        .logo span { color: white; }
        nav ul { display: flex; list-style: none; gap: 20px; margin: 0; padding: 0; }
        nav a { color: var(--text-main); text-decoration: none; font-weight: 500; transition: 0.3s; }
        nav a:hover { color: var(--accent); }

        /* کارت اصلی */
        .detail-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            border: 1px solid #333;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin-top: 80px;
        }
        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333;
            padding-bottom: 20px;
            margin-bottom: 20px;
        }
        .symbol-large { font-size: 2rem; font-weight: bold; color: white; }
        .date-large { font-size: 1.1rem; color: var(--text-muted); }
        
        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .info-item {
            background: var(--input-bg);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #444;
        }
        .info-label { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 5px; }
        .info-value { font-size: 1.2rem; font-weight: bold; color: white; }
        
        .badge {
            padding: 6px 12px; border-radius: 6px; font-size: 0.9rem; font-weight: bold;
        }
        .badge-long { background: rgba(0, 200, 83, 0.2); color: #00c853; }
        .badge-short { background: rgba(255, 61, 0, 0.2); color: #ff3d00; }
        .badge-leverage { background: rgba(212, 175, 55, 0.2); color: var(--accent); }

        .pnl-section {
            text-align: center;
            padding: 20px;
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
            margin-bottom: 30px;
        }
        .pnl-big { font-size: 2.5rem; font-weight: bold; }
        .text-success { color: var(--success); }
        .text-danger { color: var(--danger); }

        .image-section {
            text-align: center;
            margin-bottom: 20px;
        }
        .detail-image {
            max-width: 100%;
            max-height: 500px;
            border-radius: 8px;
            border: 1px solid #444;
            cursor: zoom-in;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .btn-back {
            display: inline-block;
            padding: 10px 25px;
            background: var(--input-bg);
            color: white;
            border: 1px solid #555;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            transition: 0.2s;
            cursor: pointer;
        }
        .btn-back:hover { background: #333; border-color: var(--accent); color: var(--accent); }

        .btn-delete {
            background: rgba(255, 61, 0, 0.1);
            color: var(--danger);
            border: 1px solid var(--danger);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            font-weight: bold;
            margin-top: 20px;
            width: 100%;
        }
        .btn-delete:hover { background: var(--danger); color: white; }

        .lightbox {
            display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); justify-content: center; align-items: center; cursor: zoom-out;
        }
        .lightbox img { max-width: 90%; max-height: 90%; border-radius: 8px; border: 1px solid #444; }
    </style>
</head>
<body>
<header id="mainHeader">
    <div class="nav-container">
        <a href="index.html" class="logo">₿ <span>کریپتو ژورنال</span></a>
        <nav>
            <ul>
                <li><a href="crypto-data.html">بازگشت به لیست</a></li>
            </ul>
        </nav>
    </div>
</header>

<div class="container">
    <div class="detail-card" id="detailContent">
        <!-- محتوا توسط جاوااسکریپت پر می‌شود -->
        <div style="text-align: center; color: #777;">در حال بارگذاری...</div>
    </div>
</div>

<div id="lightbox" class="lightbox" onclick="this.style.display='none'">
    <img id="lightboxImg" src="">
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // دریافت ID از URL
        const params = new URLSearchParams(window.location.search);
        const tradeId = parseInt(params.get('id'));

        if (!tradeId) {
            document.getElementById('detailContent').innerHTML = '<h3 style="text-align:center; color:var(--danger)">معامله‌ای یافت نشد.</h3>';
            return;
        }

        // خواندن داده‌ها
        const savedData = localStorage.getItem('cryptoTrades');
        if (!savedData) {
            document.getElementById('detailContent').innerHTML = '<h3 style="text-align:center; color:#777">داده‌ای موجود نیست.</h3>';
            return;
        }

        const trades = JSON.parse(savedData);
        const trade = trades.find(t => t.id === tradeId);

        if (!trade) {
            document.getElementById('detailContent').innerHTML = '<h3 style="text-align:center; color:var(--danger)">معامله با این شناسه وجود ندارد.</h3>';
            return;
        }

        // رندر کردن اطلاعات
        renderTradeDetail(trade);
    });

    function renderTradeDetail(trade) {
        const container = document.getElementById('detailContent');
        const isProfit = trade.pnl >= 0;
        const pnlClass = isProfit ? 'text-success' : 'text-danger';
        const pnlSign = isProfit ? '+' : '';
        const typeClass = trade.type === 'Long' ? 'badge-long' : 'badge-short';

        let imageHtml = '';
        if (trade.image) {
            imageHtml = `
                <div class="image-section">
                    <img src="${trade.image}" class="detail-image" onclick="openLightbox(this.src)" alt="تحلیل">
                </div>
            `;
        }

        container.innerHTML = `
            <div class="detail-header">
                <div>
                    <div class="symbol-large">${trade.symbol}</div>
                    <div class="date-large">${trade.date}</div>
                </div>
                <div>
                    <span class="badge ${typeClass}">${trade.type}</span>
                </div>
            </div>

            ${imageHtml}

            <div class="pnl-section">
                <div style="color: var(--text-muted); margin-bottom: 5px;">سود / ضرر خالص</div>
                <div class="pnl-big ${pnlClass}">${pnlSign}$${trade.pnl.toLocaleString()}</div>
            </div>

            <div class="detail-grid">
                <div class="info-item">
                    <div class="info-label">اهرم</div>
                    <div class="info-value"><span class="badge badge-leverage">x${trade.leverage}</span></div>
                </div>
                <div class="info-item">
                    <div class="info-label">سرمایه (دلار)</div>
                    <div class="info-value">$${trade.capital.toLocaleString()}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">حجم (Lot)</div>
                    <div class="info-value">${trade.volume}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">وضعیت</div>
                    <div class="info-value" style="color: ${isProfit ? 'var(--success)' : 'var(--danger)'}">
                        ${isProfit ? 'سودده' : 'ضررده'}
                    </div>
                </div>
            </div>

            <button class="btn-delete" onclick="deleteTrade(${trade.id})">حذف این معامله</button>
        `;
    }

    function deleteTrade(id) {
        if(confirm('آیا از حذف این معامله اطمینان دارید؟')) {
            let trades = JSON.parse(localStorage.getItem('cryptoTrades')) || [];
            trades = trades.filter(t => t.id !== id);
            localStorage.setItem('cryptoTrades', JSON.stringify(trades));
            alert('معامله حذف شد. در حال بازگشت به لیست...');
            window.location.href = 'crypto-data.html';
        }
    }

    function openLightbox(src) {
        const lb = document.getElementById('lightbox');
        document.getElementById('lightboxImg').src = src;
        lb.style.display = 'flex';
    }

    window.addEventListener('scroll', () => {
        const header = document.getElementById('mainHeader');
        if (window.scrollY > 50) header.classList.add('scrolled');
        else header.classList.remove('scrolled');
    });
</script>
</body>
</html>