<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>معاملات کریپتو - بومی‌ترید</title>
    <style>
        @font-face {
            font-family: 'Estedad';
            src: url('fonts/Estedad-Black.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --input-bg: #2c2c2c;
            --text-main: #e0e0e0;
            --text-muted: #a0a0a0;
            --accent: #d4af37;
            --success: #00c853;
            --danger: #ff3d00;
            --border-radius: 12px;
        }
        * { box-sizing: border-box; outline: none; }
        body {
            font-family: 'Estedad', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        /* هدر */
        header {
            position: fixed; top: 0; width: 100%; z-index: 1000; padding: 20px 0; transition: 0.4s; background: transparent;
        }
        header.scrolled {
            background: rgba(18, 18, 18, 0.95); backdrop-filter: blur(12px); border-bottom: 1px solid #333; padding: 10px 0;
        }
        .nav-container { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; padding: 0 20px; }
        .logo { font-size: 1.8rem; font-weight: bold; color: var(--accent); text-decoration: none; display: flex; align-items: center; gap: 10px; }
        .logo span { color: white; }
        nav ul { display: flex; list-style: none; gap: 20px; margin: 0; padding: 0; }
        nav a { color: var(--text-main); text-decoration: none; font-weight: 500; transition: 0.3s; }
        nav a:hover { color: var(--accent); }

        /* بخش فیلترها */
        .filters-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            border: 1px solid #333;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            align-items: end;
        }
        .filter-group label { display: block; margin-bottom: 8px; color: var(--text-muted); font-size: 0.9rem; }
        .filter-input {
            width: 100%; padding: 10px; background: var(--input-bg); border: 1px solid #444;
            color: white; border-radius: 8px; font-family: inherit;
        }
        .btn {
            padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; font-family: inherit; transition: 0.2s;
        }
        .btn-primary { background: var(--accent); color: #000; }
        .btn-outline { background: transparent; border: 1px solid #555; color: #ccc; }

        /* گرید کارت‌ها */
        .cards-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: flex-start;
        }
        
        /* استایل کارت معامله */
        .trade-card {
            background: var(--card-bg);
            border: 1px solid #333;
            border-radius: var(--border-radius);
            padding: 20px;
            width: 300px;
            flex-shrink: 0;
            position: relative;
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            cursor: pointer; /* <-- این خط را اضافه کنید */
        }
        .trade-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.4);
            border-color: var(--accent);
        }
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
        }
        .card-symbol { font-size: 1.2rem; font-weight: bold; color: white; }
        .card-date { font-size: 0.8rem; color: var(--text-muted); }
        
        .card-body { margin-bottom: 15px; }
        .card-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.95rem; }
        .card-label { color: var(--text-muted); }
        .card-value { font-weight: bold; }
        
        .badge {
            padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: bold;
        }
        .badge-long { background: rgba(0, 200, 83, 0.2); color: #00c853; }
        .badge-short { background: rgba(255, 61, 0, 0.2); color: #ff3d00; }
        .badge-leverage { background: rgba(212, 175, 55, 0.2); color: var(--accent); }
        
        .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
            border-top: 1px solid #333;
            padding-top: 10px;
        }
        .pnl-value { font-size: 1.1rem; font-weight: bold; }
        .text-success { color: var(--success); }
        .text-danger { color: var(--danger); }
        
        .btn-delete-card {
            background: none; border: none; color: #555; cursor: pointer; font-size: 1.2rem;
            transition: color 0.2s;
        }
        .btn-delete-card:hover { color: var(--danger); }

        /* --- استایل تصویر کوچک (Thumbnail) --- */
        .card-thumb {
            width: 100%;
            height: 140px; /* ارتفاع ثابت برای نظم */
            object-fit: cover; /* برش خوردن تصویر برای پر کردن کادر */
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #444;
            cursor: zoom-in;
            display: none; /* پیش‌فرض مخفی */
            transition: transform 0.2s;
        }
        .noimage-thump {
            display: flex;
            width: 100%;
            height: 140px;
            text-align: center;
            font-family: "Estedad";
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #444;
            cursor: zoom-in;
            transition: transform 0.2s;
        }
        .noimage-thump p {
            margin: auto;
            text-align: center;
        }
        .card-thumb:hover {
            transform: scale(1.02);
            border-color: var(--accent);
        }
        .card-thumb.show { display: block; }

        .empty-state {
            text-align: center; color: #555; padding: 50px; grid-column: 1 / -1;
        }
    </style>
</head>
<body>
<header id="mainHeader">
    <div class="nav-container">
        <a href="index.html" class="logo">₿ <span>کریپتو ژورنال</span></a>
        <nav>
            <ul>
                <li><a href="cryptoadd.html">افزودن معامله</a></li>
                <li><a href="index.html">بازگشت به خانه</a></li>
            </ul>
        </nav>
    </div>
</header>

<div class="container" style="margin-top: 100px;">
    <!-- بخش فیلترها -->
    <div class="filters-card">
        <div class="filter-group">
            <label>جستجوی نماد</label>
            <input type="text" id="filterSymbol" class="filter-input" placeholder="مثلاً BTC" oninput="applyFilters()">
        </div>
        <div class="filter-group">
            <label>نوع معامله</label>
            <select id="filterType" class="filter-input" onchange="applyFilters()">
                <option value="all">همه</option>
                <option value="Long">لانگ</option>
                <option value="Short">شورت</option>
            </select>
        </div>
        <div class="filter-group">
            <label>وضعیت</label>
            <select id="filterStatus" class="filter-input" onchange="applyFilters()">
                <option value="all">همه</option>
                <option value="profit">سودده</option>
                <option value="loss">ضررده</option>
            </select>
        </div>
        <div class="filter-group">
            <button class="btn btn-outline" onclick="resetFilters()">پاک کردن فیلترها</button>
        </div>
    </div>

    <!-- گرید کارت‌ها -->
    <div id="cardsContainer" class="cards-grid">
        <!-- کارت‌ها اینجا اضافه می‌شوند -->
    </div>
</div>

<script>
    let trades = [];
    let filteredTrades = [];

    document.addEventListener('DOMContentLoaded', () => {
        const savedData = localStorage.getItem('cryptoTrades');
        if (savedData) {
            trades = JSON.parse(savedData);
        }
        filteredTrades = [...trades];
        renderCards();
    });

    function applyFilters() {
        const symbolQuery = document.getElementById('filterSymbol').value.toLowerCase();
        const typeQuery = document.getElementById('filterType').value;
        const statusQuery = document.getElementById('filterStatus').value;

        filteredTrades = trades.filter(trade => {
            const matchSymbol = trade.symbol.toLowerCase().includes(symbolQuery);
            const matchType = typeQuery === 'all' || trade.type === typeQuery;
            const matchStatus = statusQuery === 'all' || trade.status === statusQuery;
            return matchSymbol && matchType && matchStatus;
        });

        renderCards();
    }

    function resetFilters() {
        document.getElementById('filterSymbol').value = '';
        document.getElementById('filterType').value = 'all';
        document.getElementById('filterStatus').value = 'all';
        filteredTrades = [...trades];
        renderCards();
    }

    // function renderCards() {
    //     const container = document.getElementById('cardsContainer');
    //     container.innerHTML = '';

    //     if (filteredTrades.length === 0) {
    //         container.innerHTML = '<div class="empty-state">معامله‌ای یافت نشد.</div>';
    //         return;
    //     }

    //     const sortedTrades = [...filteredTrades].sort((a, b) => b.id - a.id);

    //     sortedTrades.forEach(trade => {
    //         const card = document.createElement('div');
    //         card.className = 'trade-card';
            
    //         const isProfit = trade.pnl >= 0;
    //         const pnlClass = isProfit ? 'text-success' : 'text-danger';
    //         const pnlSign = isProfit ? '+' : '';
    //         const typeClass = trade.type === 'Long' ? 'badge-long' : 'badge-short';
            
    //         // مدیریت تصویر: اگر تصویر وجود دارد، کلاس show اضافه می‌شود
    //         let imageHtml = '';
    //         if (trade.image) {
    //             imageHtml = `<img src="${trade.image}" class="card-thumb show" onclick="openLightbox('${trade.image}')" alt="تحلیل">`;
    //         } else {
    //             imageHtml = `<div class="noimage-thump">
    //                 <p>تصویری موجود نیست</p>
    //                 </div>`
    //         }

    //         card.innerHTML = `
    //             ${imageHtml}
    //             <div class="card-header">
    //                 <span class="card-symbol">${trade.symbol}</span>
    //                 <span class="card-date">${trade.date}</span>
    //             </div>
    //             <div class="card-body">
    //                 <div class="card-row">
    //                     <span class="card-label">نوع:</span>
    //                     <span class="badge ${typeClass}">${trade.type}</span>
    //                 </div>
    //                 <div class="card-row">
    //                     <span class="card-label">اهرم:</span>
    //                     <span class="badge badge-leverage">x${trade.leverage}</span>
    //                 </div>
    //                 <div class="card-row">
    //                     <span class="card-label">سرمایه:</span>
    //                     <span class="card-value">$${trade.capital.toLocaleString()}</span>
    //                 </div>
    //                 <div class="card-row">
    //                     <span class="card-label">حجم:</span>
    //                     <span class="card-value">${trade.volume}</span>
    //                 </div>
    //             </div>
    //             <div class="card-footer">
    //                 <span class="pnl-value ${pnlClass}">${pnlSign}$${trade.pnl.toLocaleString()}</span>
    //                 <button class="btn-delete-card" onclick="deleteTrade(${trade.id})">×</button>
    //             </div>
    //         `;
    //         container.appendChild(card);
    //     });
    // }
    function renderCards() {
        const container = document.getElementById('cardsContainer');
        container.innerHTML = '';
        
        if (filteredTrades.length === 0) {
            container.innerHTML = '<div class="empty-state">معامله‌ای یافت نشد.</div>';
            return;
        }

        const sortedTrades = [...filteredTrades].sort((a, b) => b.id - a.id);

        sortedTrades.forEach(trade => {
            const card = document.createElement('div');
            card.className = 'trade-card';
            
            // --- اضافه کردن رویداد کلیک برای هدایت به صفحه جزئیات ---
            card.onclick = function(e) {
                // اگر روی دکمه حذف کلیک شد، کاری نکن (تابع deleteTrade خودش اجرا می‌شود)
                if (e.target.closest('.btn-delete-card')) return;
                
                // اگر روی تصویر کلیک شد، کاری نکن (تابع openLightbox خودش اجرا می‌شود)
                if (e.target.closest('.card-thumb')) return;

                // در غیر این صورت به صفحه جزئیات برو
                window.location.href = `cryptoDetail.html?id=${trade.id}`;
            };
            // -----------------------------------------------------------

            const isProfit = trade.pnl >= 0;
            const pnlClass = isProfit ? 'text-success' : 'text-danger';
            const pnlSign = isProfit ? '+' : '';
            const typeClass = trade.type === 'Long' ? 'badge-long' : 'badge-short';
            
            // مدیریت تصویر
            let imageHtml = '';
            if (trade.image) {
                imageHtml = `<img src="${trade.image}" class="card-thumb show" onclick="openLightbox('${trade.image}')" alt="تحلیل">`;
            } else {
                // استایل برای حالت بدون تصویر
                imageHtml = `
                    <div class="card-thumb noimage-thumb" style="display: flex; align-items: center; justify-content: center; background: #252525; color: #555; font-size: 0.8rem; border: 1px dashed #444;">
                        <p>بدون تصویر</p>
                    </div>
                `;
            }

            card.innerHTML = `
                ${imageHtml}
                <div class="card-header">
                    <span class="card-symbol">${trade.symbol}</span>
                    <span class="card-date">${trade.date}</span>
                </div>
                <div class="card-body">
                    <div class="card-row">
                        <span class="card-label">نوع:</span>
                        <span class="badge ${typeClass}">${trade.type}</span>
                    </div>
                    <div class="card-row">
                        <span class="card-label">اهرم:</span>
                        <span class="badge badge-leverage">x${trade.leverage}</span>
                    </div>
                    <div class="card-row">
                        <span class="card-label">سرمایه:</span>
                        <span class="card-value">$${trade.capital.toLocaleString()}</span>
                    </div>
                    <div class="card-row">
                        <span class="card-label">حجم:</span>
                        <span class="card-value">${trade.volume}</span>
                    </div>
                </div>
                <div class="card-footer">
                    <span class="pnl-value ${pnlClass}">${pnlSign}$${trade.pnl.toLocaleString()}</span>
                    <button class="btn-delete-card" onclick="deleteTrade(${trade.id})">×</button>
                </div>
            `;
            container.appendChild(card);
        });
    }

    function deleteTrade(id) {
        if(confirm('آیا از حذف این معامله اطمینان دارید؟')) {
            trades = trades.filter(t => t.id !== id);
            filteredTrades = filteredTrades.filter(t => t.id !== id);
            localStorage.setItem('cryptoTrades', JSON.stringify(trades));
            renderCards();
        }
    }

    // لایت‌باکس برای نمایش تصویر بزرگ
    function openLightbox(src) {
        const lightbox = document.createElement('div');
        lightbox.style.cssText = `
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 2000; display: flex;
            justify-content: center; align-items: center; cursor: zoom-out;
        `;
        const img = document.createElement('img');
        img.src = src;
        img.style.cssText = `max-width: 90%; max-height: 90%; border-radius: 8px; border: 1px solid #444;`;
        lightbox.appendChild(img);
        document.body.appendChild(lightbox);
        lightbox.onclick = function() {
            document.body.removeChild(lightbox);
        };
    }

    window.addEventListener('scroll', () => {
        const header = document.getElementById('mainHeader');
        if (window.scrollY > 50) header.classList.add('scrolled');
        else header.classList.remove('scrolled');
    });
</script>
</body>
</html>