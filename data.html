<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø¯ÛŒØ±ÛŒØª Ùˆ ØªØ­Ù„ÛŒÙ„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ - Ú˜ÙˆØ±Ù†Ø§Ù„ Ø·Ù„Ø§</title>
    <style>
            @font-face {
            font-family: 'Estedad';
            src: url('fonts/Estedad-Black.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --input-bg: #2c2c2c;
            --text-main: #e0e0e0;
            --text-muted: #a0a0a0;
            --accent: #d4af37;
            --success: #00c853;
            --danger: #ff3d00;
            --border-radius: 12px;
        }
        * { box-sizing: border-box; outline: none; }
        body {
            font-family: 'Estedad';
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }
        .card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            border: 1px solid #333;
        }
        /* Ù‡Ø¯Ø± */
        .header-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        .stats-cards {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        .stat-card {
            background: var(--input-bg);
            padding: 15px 20px;
            border-radius: 8px;
            min-width: 140px;
            text-align: center;
            border: 1px solid #444;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .stat-value { font-size: 1.2rem; font-weight: bold; margin-top: 5px; }
        .stat-sub { font-size: 0.75rem; color: #777; margin-top: 2px; }
        .text-success { color: var(--success); }
        .text-danger { color: var(--danger); }
        /* --- Ø¨Ø®Ø´ Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø±Ù…Ø§ÛŒÙ‡ --- */
        .mm-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            align-items: start;
        }
        .mm-input-group {
            background: #252525;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #444;
        }
        .mm-result-box {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid var(--accent);
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 160px;
        }
        .mm-label { font-size: 0.9rem; color: #aaa; margin-bottom: 8px; display: block; }
        .mm-input {
            width: 100%; background: var(--input-bg); border: 1px solid #555;
            color: white; padding: 10px; border-radius: 6px; margin-bottom: 10px; font-family: inherit;
        }
        .mm-input:focus { border-color: var(--accent); }
        .mm-big-value { font-size: 2.2rem; font-weight: bold; color: var(--accent); margin: 10px 0; }
        .mm-sub-text { font-size: 0.85rem; color: #888; }
        .risk-warning {
            margin-top: 10px;
            padding: 10px;
            background: rgba(255, 61, 0, 0.1);
            border: 1px solid var(--danger);
            color: var(--danger);
            border-radius: 6px;
            font-size: 0.85rem;
            display: none;
        }
        .exposure-info {
            margin-top: 10px;
            padding: 8px;
            background: rgba(0, 200, 83, 0.1);
            border: 1px solid var(--success);
            color: var(--success);
            border-radius: 6px;
            font-size: 0.85rem;
            display: none;
        }
        /* Ø¢Ù…Ø§Ø± Ù¾ÛŒØ´Ø±ÙØªÙ‡ */
        .advanced-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .adv-stat-box {
            background: #252525;
            padding: 15px;
            border-radius: 8px;
            border-right: 4px solid #555;
            transition: 0.3s;
        }
        .adv-stat-box:hover { transform: translateY(-3px); background: #2a2a2a; }
        .adv-stat-box.good { border-right-color: var(--success); }
        .adv-stat-box.bad { border-right-color: var(--danger); }
        .adv-stat-box.neutral { border-right-color: var(--accent); }
        .adv-title { font-size: 0.85rem; color: #aaa; margin-bottom: 8px; }
        .adv-value { font-size: 1.3rem; font-weight: bold; color: white; }
        .adv-desc { font-size: 0.75rem; color: #777; margin-top: 5px; }
        /* Ù†Ù…ÙˆØ¯Ø§Ø± */
        .chart-container {
            position: relative;
            height: 350px;
            width: 100%;
            margin-top: 20px;
            background: #181818;
            border-radius: 8px;
            border: 1px solid #333;
            padding: 10px;
            overflow: hidden;
        }
        svg { width: 100%; height: 100%; overflow: visible; }
        .chart-line { 
            fill: none; 
            stroke: var(--accent); 
            stroke-width: 3; 
            stroke-linecap: round; 
            stroke-linejoin: round;
            filter: drop-shadow(0 0 10px rgba(212, 175, 55, 0.6));
        }
        .chart-area { fill: url(#goldGradient); stroke: none; }
        
        /* Ø§Ø³ØªØ§ÛŒÙ„ ØªÙˆÙ„ØªÛŒÙ¾ */
        .chart-tooltip { 
            position: fixed; 
            background: rgba(30, 30, 30, 0.95); 
            color: white; 
            padding: 12px; 
            border-radius: 8px; 
            font-size: 0.85rem; 
            pointer-events: none; 
            display: none; 
            border: 1px solid var(--accent); 
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            z-index: 1000;
            min-width: 160px;
            backdrop-filter: blur(4px);
            transform: translate(15px, -50%);
        }
        .tooltip-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
        }
        .tooltip-title {
            font-weight: bold;
            color: var(--accent);
            border-bottom: 1px solid #444;
            padding-bottom: 4px;
            margin-bottom: 6px;
            display: block;
        }
        /* Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ */
        .analysis-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
            background: #252525;
            padding: 15px;
            border-radius: 8px;
        }
        input, select { background: var(--input-bg); border: 1px solid #444; color: white; padding: 10px; border-radius: 8px; width: 100%; font-family: inherit; }
        .btn { padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; font-family: inherit; transition: 0.2s; }
        .btn-primary { background: var(--accent); color: #000; }
        .btn-outline { background: transparent; border: 1px solid #555; color: #ccc; }
        /* ØªÙ‚ÙˆÛŒÙ… */
        .calendar-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); gap: 10px; margin-top: 15px; }
        .day-card { background: var(--input-bg); border: 1px solid #444; border-radius: 8px; padding: 10px; text-align: center; cursor: pointer; transition: 0.2s; }
        .day-card:hover { transform: translateY(-2px); }
        .day-card.active { border-color: var(--accent); box-shadow: 0 0 0 2px var(--accent); }
        .bg-profit { background: rgba(0, 200, 83, 0.15); border-color: var(--success); }
        .bg-loss { background: rgba(255, 61, 0, 0.15); border-color: var(--danger); }
        .text-profit { color: var(--success); }
        .text-loss { color: var(--danger); }
        /* Ø¬Ø¯ÙˆÙ„ */
        .table-container { overflow-x: auto; margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        th { text-align: right; padding: 12px; color: var(--text-muted); border-bottom: 2px solid #333; }
        td { padding: 12px; border-bottom: 1px solid #333; }
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: bold; }
        .badge-long { background: rgba(0, 200, 83, 0.15); color: #00c853; }
        .badge-short { background: rgba(255, 61, 0, 0.15); color: #ff3d00; }
        .btn-delete { background: none; border: none; color: #666; cursor: pointer; font-size: 1.2rem; }
        .btn-delete:hover { color: var(--danger); }
        #fileInput { display: none; }
        .empty-msg { text-align: center; color: #555; padding: 40px; }
        
        /* --- NEW: Ø§Ø³ØªØ§ÛŒÙ„ Ø¨Ø±Ø§ÛŒ Ù†Ù…ÙˆØ¯Ø§Ø± Ø±ÙˆØ²Ø§Ù†Ù‡ --- */
        .daily-chart-container {
            display: none; /* Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ù…Ø®ÙÛŒ */
            border: 1px solid var(--accent);
            background: #1a1a1a;
        }
        .daily-chart-container.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .chart-line-daily {
            fill: none;
            stroke: var(--success);
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        /* --- Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ ØªØµØ§ÙˆÛŒØ± --- */
        .table-thumb {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 6px;
            cursor: zoom-in;
            border: 1px solid #444;
            transition: transform 0.2s;
            display: block;
        }
        .table-thumb:hover {
            transform: scale(1.1);
            border-color: var(--accent);
        }
        .no-image {
            color: #555;
            font-size: 0.8rem;
        }
        .lightbox-img-link {
            display: inline-block;
            margin-top: 5px;
            font-size: 0.75rem;
            color: var(--accent);
            text-decoration: underline;
            cursor: pointer;
        }
        .lightbox-img-link:hover {
            color: #fff;
        }

        /* --- Ø§Ø³ØªØ§ÛŒÙ„ Ú©ÙˆÙ„â€ŒØ¢Ù¾ (Lightbox) --- */
        .lightbox {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(8px);
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        .lightbox-content {
            margin: auto;
            display: block;
            max-width: 90%;
            max-height: 85vh;
            border-radius: 4px;
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
            animation: zoomIn 0.3s ease;
            border: 1px solid #444;
        }
        .close-lightbox {
            position: absolute;
            top: 20px;
            right: 35px;
            color: #f1f1f1;
            font-size: 50px;
            font-weight: bold;
            transition: 0.3s;
            cursor: pointer;
            z-index: 2001;
        }
        .close-lightbox:hover {
            color: var(--danger);
        }
        @keyframes zoomIn {
            from {transform:scale(0.9); opacity: 0;} 
            to {transform:scale(1); opacity: 1;}
        }
        /* --- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù„ÛŒ Ù‡Ø¯Ø± --- */
header {
    position: fixed; /* Ù‡Ø¯Ø± Ù‡Ù…ÛŒØ´Ù‡ Ø¯Ø± Ø¨Ø§Ù„Ø§ÛŒ ØµÙØ­Ù‡ Ø«Ø§Ø¨Øª Ù…ÛŒâ€ŒÙ…Ø§Ù†Ø¯ */
    top: 0;
    width: 100%;
    z-index: 1000; /* Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ø±ÙˆÛŒ Ø³Ø§ÛŒØ± Ø§Ù„Ù…Ø§Ù†â€ŒÙ‡Ø§ Ù‚Ø±Ø§Ø± Ú¯ÛŒØ±Ø¯ */
    padding: 20px 0;
    transition: 0.4s; /* Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ù†Ø±Ù… Ø¨Ø±Ø§ÛŒ ØªØºÛŒÛŒØ± Ø­Ø§Ù„Øª */
    background: transparent; /* Ø¯Ø± Ø­Ø§Ù„Øª Ø¹Ø§Ø¯ÛŒ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø´ÙØ§Ù Ø§Ø³Øª */
}

/* Ø§Ø³ØªØ§ÛŒÙ„ Ù‡Ø¯Ø± ÙˆÙ‚ØªÛŒ Ú©Ø§Ø±Ø¨Ø± Ø§Ø³Ú©Ø±ÙˆÙ„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ (Ú©Ù„Ø§Ø³ scrolled ØªÙˆØ³Ø· JS Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯) */
header.scrolled {
    background: var(--glass-bg); /* Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø´ÛŒØ´Ù‡â€ŒØ§ÛŒ ØªÛŒØ±Ù‡ */
    backdrop-filter: blur(12px); /* ØªØ§Ø±ÛŒ Ú©Ø±Ø¯Ù† Ù¾Ø´Øª Ù‡Ø¯Ø± */
    border-bottom: 1px solid var(--border-color);
    padding: 10px 0; /* Ú©Ø§Ù‡Ø´ Ø§Ø±ØªÙØ§Ø¹ Ù‡Ø¯Ø± Ù‡Ù†Ú¯Ø§Ù… Ø§Ø³Ú©Ø±ÙˆÙ„ */
    box-shadow: 0 4px 20px rgba(0,0,0,0.5);
}

/* Ú©Ø§Ù†ØªÛŒÙ†Ø± ÙˆØ³Ø·â€ŒÚ†ÛŒÙ† Ø¨Ø±Ø§ÛŒ Ù„ÙˆÚ¯Ùˆ Ùˆ Ù…Ù†Ùˆ */
.nav-container {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between; /* Ù„ÙˆÚ¯Ùˆ Ø±Ø§Ø³ØªØŒ Ù…Ù†Ùˆ Ú†Ù¾ (Ø¯Ø± Ø­Ø§Ù„Øª RTL) */
    align-items: center;
    padding: 0 20px;
}

/* --- Ø§Ø³ØªØ§ÛŒÙ„ Ù„ÙˆÚ¯Ùˆ --- */
.logo {
    font-size: 1.8rem;
    font-weight: bold;
    color: var(--accent); /* Ø±Ù†Ú¯ Ø·Ù„Ø§ÛŒÛŒ */
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 10px;
    transition: 0.3s;
}

.logo span { 
    color: white; 
}

.logo:hover {
    color: var(--accent-hover);
    transform: scale(1.02);
}

/* --- Ø§Ø³ØªØ§ÛŒÙ„ Ù…Ù†Ùˆ --- */
nav ul {
    display: flex;
    list-style: none;
    gap: 30px; /* ÙØ§ØµÙ„Ù‡ Ø¨ÛŒÙ† Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ù…Ù†Ùˆ */
    margin: 0;
    padding: 0;
}

nav a {
    color: var(--text-main);
    text-decoration: none;
    font-weight: 500;
    transition: 0.3s;
    position: relative;
    padding-bottom: 5px;
}

nav a:hover { 
    color: var(--accent); 
}

/* Ø®Ø· Ø²ÛŒØ±ÛŒÙ† Ù…ØªØ­Ø±Ú© Ø¨Ø±Ø§ÛŒ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ */
nav a::after {
    content: '';
    position: absolute;
    width: 0;
    height: 2px;
    bottom: 0;
    right: 0; /* Ø´Ø±ÙˆØ¹ Ø§Ø² Ø±Ø§Ø³Øª Ø¨Ù‡ Ú†Ù¾ */
    background: var(--accent);
    transition: 0.3s;
}

nav a:hover::after { 
    width: 100%; 
}

/* --- ÙˆØ§Ú©Ù†Ø´â€ŒÚ¯Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ --- */
@media (max-width: 768px) {
    .nav-container { 
        flex-direction: column; 
        gap: 15px; 
    }
    nav ul { 
        gap: 15px; 
        font-size: 0.9rem; 
        flex-wrap: wrap; 
        justify-content: center;
    }
}
    </style>
</head>
<body>
        <!-- Ù‡Ø¯Ø± -->
        <header id="mainHeader">
            <div class="nav-container">
                <a href="#" class="logo">ğŸ“ˆ <span>Ø¨ÙˆÙ…ÛŒâ€ŒØªØ±ÛŒØ¯</span></a>
                <nav>
                    <ul>
                        <li><a href="#stats">Ø¢Ù…Ø§Ø± Ø¹Ù…Ù„Ú©Ø±Ø¯</a></li>
                        <li><a href="add.html">Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…Ø¹Ø§Ù…Ù„Ù‡</a></li>
                        <li><a href="data.html">Ù…Ø¹Ø§Ù…Ù„Ø§Øª</a></li>
                        <li><a href="scalpCalc.html">Ù…Ø§Ø´ÛŒÙ† Ø­Ø³Ø§Ø¨</a></li>
                        <li><a href="vloume.html">Ù…Ø¯ÛŒØ±ÛŒØª Ø­Ø¬Ù…</a></li>
                        <li><a href="assetManagement.html">Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø±Ø§ÛŒÛŒ</a></li>
                    </ul>
                </nav>
            </div>
        </header>
<div class="container" style="margin-top: 100px;">
    <!-- Ù‡Ø¯Ø± -->
    <div class="header-section">
        <h1 style="margin:0; color:var(--accent)">ØªØ­Ù„ÛŒÙ„ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø¹Ø§Ù…Ù„Ø§Øª</h1>
        <div class="stats-cards">
            <div class="stat-card">
                <div style="color:var(--text-muted); font-size:0.8rem">Ø®Ø§Ù„Øµ Ø³ÙˆØ¯/Ø¶Ø±Ø±</div>
                <div class="stat-value" id="netPnl">0</div>
            </div>
            <div class="stat-card">
                <div style="color:var(--text-muted); font-size:0.8rem">Ù†Ø±Ø® Ø¨Ø±Ø¯</div>
                <div class="stat-value" id="winRate">0%</div>
            </div>
            <div class="stat-card">
                <div style="color:var(--text-muted); font-size:0.8rem">ØªØ¹Ø¯Ø§Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§Øª</div>
                <div class="stat-value" id="totalCount">0</div>
                <div class="stat-sub" id="tradeTypeBreakdown" style="display:none; margin-top:5px; border-top:1px solid #444; padding-top:5px;">
                    <span class="text-success">Ù„Ø§Ù†Ú¯: <span id="longCount">0</span></span> | 
                    <span class="text-danger">Ø´ÙˆØ±Øª: <span id="shortCount">0</span></span>
                </div>
            </div>
        </div>
    </div>
    <!-- Ø¨Ø®Ø´ ØªØ­Ù„ÛŒÙ„ Ù‡ÙˆØ´Ù…Ù†Ø¯ -->
    <div class="card" style="border-color: var(--accent);">
        <h3 style="margin:0 0 10px 0; color:var(--accent);">ğŸ’¡ ØªØ­Ù„ÛŒÙ„ Ù‡ÙˆØ´Ù…Ù†Ø¯</h3>
        <div id="smartAnalysisText" style="color: #ccc; font-size: 0.95rem;">
            Ù‡Ù†ÙˆØ² Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ ØªØ­Ù„ÛŒÙ„ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.
        </div>
    </div>
    <!-- Ø¨Ø®Ø´ Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø±Ù…Ø§ÛŒÙ‡ -->
    <div class="card">
        <h3 style="margin:0 0 15px 0; color:white;">Ù…Ø§Ø´ÛŒÙ† Ø­Ø³Ø§Ø¨ Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø±Ù…Ø§ÛŒÙ‡</h3>
        <div class="mm-grid">
            <div class="mm-input-group">
                <label class="mm-label">Ø³Ø±Ù…Ø§ÛŒÙ‡ Ú©Ù„ (ØªÙˆÙ…Ø§Ù†)</label>
                <input type="number" id="mmCapital" class="mm-input" placeholder="Ù…Ø«Ù„Ø§: 100000000" oninput="calculateMM()">
                <label class="mm-label">Ø¯Ø±ØµØ¯ Ø±ÛŒØ³Ú© Ø¯Ø± Ø§ÛŒÙ† Ù…Ø¹Ø§Ù…Ù„Ù‡ (%)</label>
                <input type="number" id="mmRiskPercent" class="mm-input" value="2" step="0.5" oninput="calculateMM()">
                <label class="mm-label">Ø§Ø³ØªØ§Ù¾ Ù„Ø§Ø³ (ØªÙØ§ÙˆØª Ù‚ÛŒÙ…Øª ÙˆØ±ÙˆØ¯ Ùˆ Ø®Ø±ÙˆØ¬)</label>
                <input type="number" id="mmStopLoss" class="mm-input" placeholder="Ù…Ø«Ù„Ø§: 5000" oninput="calculateMM()">
                <label class="mm-label">Ø§Ø±Ø²Ø´ Ù‡Ø± ÙˆØ§Ø­Ø¯ (ØªÙˆÙ…Ø§Ù†)</label>
                <input type="number" id="mmUnitValue" class="mm-input" placeholder="Ù…Ø«Ù„Ø§: 2300000" oninput="calculateMM()">
            </div>
            <div class="mm-result-box">
                <div style="color:#aaa; font-size:0.9rem">Ø­Ø¯Ø§Ú©Ø«Ø± Ø­Ø¬Ù… Ù…Ø¬Ø§Ø² (ÙˆØ§Ø­Ø¯)</div>
                <div class="mm-big-value" id="mmResult">-</div>
                <div class="mm-sub-text" id="mmRiskAmount">Ù…Ù‚Ø¯Ø§Ø± Ù¾ÙˆÙ„ Ø¯Ø± Ø®Ø·Ø±: 0 ØªÙˆÙ…Ø§Ù†</div>
                <div id="mmExposure" class="exposure-info"></div>
                <div id="mmWarning" class="risk-warning"></div>
            </div>
        </div>
    </div>
    <!-- Ø¨Ø®Ø´ Ø¢Ù…Ø§Ø± Ù¾ÛŒØ´Ø±ÙØªÙ‡ -->
    <div class="card">
        <h3 style="margin:0 0 15px 0; color:white;">ØªØ­Ù„ÛŒÙ„ Ø¹Ù…ÛŒÙ‚ Ùˆ Ø±ÙˆØ§Ù†Ø´Ù†Ø§Ø³ÛŒ Ø¨Ø§Ø²Ø§Ø±</h3>
        <div class="advanced-stats-grid">
            <div class="adv-stat-box neutral" id="boxRR">
                <div class="adv-title">Ø¶Ø±ÛŒØ¨ Ø³ÙˆØ¯ Ø¨Ù‡ Ø¶Ø±Ø± (R/R)</div>
                <div class="adv-value" id="valRR">-</div>
                <div class="adv-desc">Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø³ÙˆØ¯ ØªÙ‚Ø³ÛŒÙ… Ø¨Ø± Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø¶Ø±Ø±</div>
            </div>
            <div class="adv-stat-box good">
                <div class="adv-title">Ø·ÙˆÙ„Ø§Ù†ÛŒâ€ŒØªØ±ÛŒÙ† Ø±ÙˆÙ†Ø¯ Ø¨Ø±Ø¯</div>
                <div class="adv-value text-success" id="valWinStreak">0</div>
                <div class="adv-desc">Ù…Ø¹Ø§Ù…Ù„Ù‡</div>
            </div>
            <div class="adv-stat-box bad">
                <div class="adv-title">Ø·ÙˆÙ„Ø§Ù†ÛŒâ€ŒØªØ±ÛŒÙ† Ø±ÙˆÙ†Ø¯ Ø¨Ø§Ø®Øª</div>
                <div class="adv-value text-danger" id="valLossStreak">0</div>
                <div class="adv-desc">Ù…Ø¹Ø§Ù…Ù„Ù‡ (Ù‡Ø´Ø¯Ø§Ø± ØªÛŒÙ„Øª)</div>
            </div>
            <div class="adv-stat-box good">
                <div class="adv-title">Ø¨Ù‡ØªØ±ÛŒÙ† Ù…Ø¹Ø§Ù…Ù„Ù‡</div>
                <div class="adv-value text-success" id="valBestTrade">0</div>
                <div class="adv-desc">Ø¨ÛŒØ´ØªØ±ÛŒÙ† Ø³ÙˆØ¯ ØªÚ© Ù…Ø¹Ø§Ù…Ù„Ù‡</div>
            </div>
            <div class="adv-stat-box bad">
                <div class="adv-title">Ø¨Ø¯ØªØ±ÛŒÙ† Ù…Ø¹Ø§Ù…Ù„Ù‡</div>
                <div class="adv-value text-danger" id="valWorstTrade">0</div>
                <div class="adv-desc">Ø¨ÛŒØ´ØªØ±ÛŒÙ† Ø¶Ø±Ø± ØªÚ© Ù…Ø¹Ø§Ù…Ù„Ù‡</div>
            </div>
        </div>
    </div>
    
    <!-- --- NEW: Ø¨Ø®Ø´ Ù†Ù…ÙˆØ¯Ø§Ø± Ø±ÙˆØ²Ø§Ù†Ù‡ (Ù¾Ù†Ù‡Ø§Ù† ØªØ§ Ø²Ù…Ø§Ù†ÛŒ Ú©Ù‡ Ø±ÙˆØ²ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´ÙˆØ¯) --- -->
    <div class="card daily-chart-container" id="dailyChartCard">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <h3 style="margin:0; color:var(--success);">ğŸ“… Ù†Ù…ÙˆØ¯Ø§Ø± Ø±ÙˆÙ†Ø¯ Ø±ÙˆØ²Ø§Ù†Ù‡: <span id="dailyChartDateLabel"></span></h3>
            <button class="btn btn-outline" style="font-size:0.8rem; padding:5px 10px;" onclick="closeDailyChart()">Ø¨Ø³ØªÙ†</button>
        </div>
        <div class="chart-container" style="height: 250px; border-color: var(--success);">
            <div id="tooltipDaily" class="chart-tooltip"></div>
            <svg id="dailyChartSvg" preserveAspectRatio="none"></svg>
        </div>
    </div>
    <!-- Ø¨Ø®Ø´ Ù†Ù…ÙˆØ¯Ø§Ø± Ø§ØµÙ„ÛŒ -->
    <div class="card">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <h3 style="margin:0; color:white;">Ù†Ù…ÙˆØ¯Ø§Ø± Ø¹Ù…Ù„Ú©Ø±Ø¯ Ú©Ù„ÛŒ (Equity Curve)</h3>
        </div>
        <div class="analysis-controls">
            <div><label style="font-size:0.8rem; color:#aaa; display:block; margin-bottom:5px;">Ø§Ø² ØªØ§Ø±ÛŒØ®</label><input type="text" id="startDate" placeholder="1403/10/01"></div>
            <div><label style="font-size:0.8rem; color:#aaa; display:block; margin-bottom:5px;">ØªØ§ ØªØ§Ø±ÛŒØ®</label><input type="text" id="endDate" placeholder="1403/10/30"></div>
            <div style="display:flex; align-items:flex-end;"><button class="btn btn-primary" style="width:100%" onclick="applyDateFilter()">Ø§Ø¹Ù…Ø§Ù„ ÙÛŒÙ„ØªØ±</button></div>
            <div style="display:flex; align-items:flex-end;"><button class="btn btn-outline" style="width:100%" onclick="resetFilters()">Ù†Ù…Ø§ÛŒØ´ Ú©Ù„ ØªØ§Ø±ÛŒØ®</button></div>
        </div>
        <div class="chart-container" id="chartContainer">
            <div id="tooltip" class="chart-tooltip"></div>
            <svg id="equityChart" preserveAspectRatio="none">
                <defs>
                    <linearGradient id="goldGradient" x1="0" x2="0" y1="0" y2="1">
                        <stop offset="0%" stop-color="#d4af37" stop-opacity="0.4"/>
                        <stop offset="100%" stop-color="#d4af37" stop-opacity="0"/>
                    </linearGradient>
                </defs>
            </svg>
        </div>
    </div>
    <!-- Ø¨Ø®Ø´ ØªÙ‚ÙˆÛŒÙ… -->
    <div class="card" >
        <div style="display:flex; justify-content:space-between; align-items:center; ">
            <h3 style="margin:0; color:white;">Ù†Ù…Ø§ÛŒ Ø±ÙˆØ²Ø§Ù†Ù‡</h3>
            <button class="btn btn-outline" style="font-size:0.8rem; padding:5px 10px;" onclick="resetCalendarFilter()">Ù‡Ù…Ù‡ Ø±ÙˆØ²Ù‡Ø§</button>
        </div>
        <div class="calendar-grid" style="display: flex;" id="calendarGrid"></div>
    </div>
    <!-- Ø¬Ø¯ÙˆÙ„ -->
    <div class="card">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <h3 style="margin:0; color:white;">Ø¬Ø²Ø¦ÛŒØ§Øª Ù…Ø¹Ø§Ù…Ù„Ø§Øª</h3>
            <div style="display:flex; gap:10px;">
                <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„</button>
                <button class="btn btn-outline" onclick="clearData()">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†</button>
                <input type="file" id="fileInput" accept=".json" onchange="uploadData(this)">
            </div>
        </div>
        <div class="table-container">
            <table id="mainTable">
                <thead>
                    <tr>
                        <th>ØªØµÙˆÛŒØ±</th>
                        <th>ØªØ§Ø±ÛŒØ®</th>
                        <th>Ù†Ù…Ø§Ø¯</th>
                        <th>Ù†ÙˆØ¹</th>
                        <th>(Ù‚ÛŒÙ…Øª) ÙˆØ±ÙˆØ¯</th>
                        <th>(Ù‚ÛŒÙ…Øª) Ø®Ø±ÙˆØ¬</th>
                        <th>ØªØ¹Ø¯Ø§Ø¯</th>
                        <th>ÙˆØ¶Ø¹ÛŒØª</th>
                        <th>Ù…Ø¨Ù„Øº</th>
                        <th>Ø­Ø°Ù</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
            <div id="emptyState" class="empty-msg">Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</div>
        </div>
    </div>
</div>

<!-- Ø§Ù„Ù…Ø§Ù† Ú©ÙˆÙ„â€ŒØ¢Ù¾ -->
<div id="lightbox" class="lightbox" onclick="closeLightbox(event)">
    <span class="close-lightbox" onclick="closeLightbox(event)">&times;</span>
    <img class="lightbox-content" id="lightboxImg">
</div>

<script>
    let trades = [];
    let filteredTrades = [];
    let selectedDate = null;
    
    function parseMoney(str) {
        if (!str) return 0;
        return parseFloat(str.toString().replace(/,/g, '')) || 0;
    }
    document.addEventListener('DOMContentLoaded', () => {
        const savedCapital = localStorage.getItem('mmCapital');
        if (savedCapital) document.getElementById('mmCapital').value = savedCapital;
        const savedUnitValue = localStorage.getItem('mmUnitValue');
        if (savedUnitValue) document.getElementById('mmUnitValue').value = savedUnitValue;
        const savedData = localStorage.getItem('goldTrades');
        if (savedData) {
            trades = JSON.parse(savedData);
            filteredTrades = [...trades];
            updateAll();
        }
    });
    function updateAll() {
        renderCalendar();
        renderTable(filteredTrades);
        updateBasicStats(filteredTrades);
        updateAdvancedStats(filteredTrades);
        drawChart(filteredTrades);
        updateSmartAnalysis(filteredTrades);
    }
    function updateSmartAnalysis(data) {
        const textEl = document.getElementById('smartAnalysisText');
        if (data.length === 0) {
            textEl.innerHTML = 'Ù‡Ù†ÙˆØ² Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ ØªØ­Ù„ÛŒÙ„ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.';
            return;
        }
        let longPnl = 0, shortPnl = 0;
        let longCount = 0, shortCount = 0;
        data.forEach(t => {
            const val = parseMoney(t.profit);
            if (t.type === 'Long') {
                longCount++;
                longPnl += val;
            } else if (t.type === 'Short') {
                shortCount++;
                shortPnl += val;
            }
        });
        let message = '';
        if (longPnl > shortPnl && longCount > 0) {
            message = `ğŸ“ˆ Ø¨Ù‡ØªØ±ÛŒÙ† Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø´Ù…Ø§ Ø¯Ø± Ù…Ø¹Ø§Ù…Ù„Ø§Øª <strong style="color:var(--success)">Ù„Ø§Ù†Ú¯</strong> Ø¨ÙˆØ¯Ù‡ Ø§Ø³Øª (Ø³ÙˆØ¯ Ø®Ø§Ù„Øµ: ${longPnl.toLocaleString()}).`;
        } else if (shortPnl > longPnl && shortCount > 0) {
            message = `ğŸ“‰ Ø¨Ù‡ØªØ±ÛŒÙ† Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø´Ù…Ø§ Ø¯Ø± Ù…Ø¹Ø§Ù…Ù„Ø§Øª <strong style="color:var(--danger)">Ø´ÙˆØ±Øª</strong> Ø¨ÙˆØ¯Ù‡ Ø§Ø³Øª (Ø³ÙˆØ¯ Ø®Ø§Ù„Øµ: ${shortPnl.toLocaleString()}).`;
        } else {
            message = 'Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø´Ù…Ø§ Ø¯Ø± Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ù„Ø§Ù†Ú¯ Ùˆ Ø´ÙˆØ±Øª ØªÙ‚Ø±ÛŒØ¨Ø§Ù‹ Ø¨Ø±Ø§Ø¨Ø± Ø§Ø³Øª.';
        }
        if (longCount > shortCount * 2) {
            message += '<br>ğŸ’¡ Ù†Ú©ØªÙ‡: Ø´Ù…Ø§ ØªÙ…Ø§ÛŒÙ„ Ø²ÛŒØ§Ø¯ÛŒ Ø¨Ù‡ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ù„Ø§Ù†Ú¯ Ø¯Ø§Ø±ÛŒØ¯.';
        } else if (shortCount > longCount * 2) {
            message += '<br>ğŸ’¡ Ù†Ú©ØªÙ‡: Ø´Ù…Ø§ ØªÙ…Ø§ÛŒÙ„ Ø²ÛŒØ§Ø¯ÛŒ Ø¨Ù‡ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø´ÙˆØ±Øª Ø¯Ø§Ø±ÛŒØ¯.';
        }
        textEl.innerHTML = message;
    }
    function calculateMM() {
        const capital = parseFloat(document.getElementById('mmCapital').value);
        const riskPercent = parseFloat(document.getElementById('mmRiskPercent').value);
        const stopLoss = parseFloat(document.getElementById('mmStopLoss').value);
        const unitValue = parseFloat(document.getElementById('mmUnitValue').value);
        const resultEl = document.getElementById('mmResult');
        const riskAmountEl = document.getElementById('mmRiskAmount');
        const warningEl = document.getElementById('mmWarning');
        const exposureEl = document.getElementById('mmExposure');
        
        if (capital) localStorage.setItem('mmCapital', capital);
        if (unitValue) localStorage.setItem('mmUnitValue', unitValue);
        
        warningEl.style.display = 'none';
        exposureEl.style.display = 'none';
        
        if (!capital || !riskPercent || !stopLoss || stopLoss <= 0) {
            resultEl.innerText = "-";
            riskAmountEl.innerText = "Ù…Ù‚Ø¯Ø§Ø± Ù¾ÙˆÙ„ Ø¯Ø± Ø®Ø·Ø±: 0 ØªÙˆÙ…Ø§Ù†";
            if (stopLoss === 0) warningEl.style.display = 'block';
            return;
        }
        
        const riskAmount = capital * (riskPercent / 100);
        let positionSize = riskAmount / stopLoss;
        positionSize = Math.floor(positionSize);
        
        let totalPositionValue = 0;
        let exposurePercent = 0;
        let hasUnitValue = false;
        if (unitValue && unitValue > 0) {
            hasUnitValue = true;
            totalPositionValue = positionSize * unitValue;
            exposurePercent = (totalPositionValue / capital) * 100;
        }
        
        resultEl.innerText = positionSize.toLocaleString();
        riskAmountEl.innerText = `Ù…Ù‚Ø¯Ø§Ø± Ù¾ÙˆÙ„ Ø¯Ø± Ø®Ø·Ø±: ${Math.round(riskAmount).toLocaleString()} ØªÙˆÙ…Ø§Ù†`;
        
        if (hasUnitValue) {
            if (totalPositionValue > capital) {
                warningEl.innerText = `âš ï¸ Ø³Ø±Ù…Ø§ÛŒÙ‡ Ù†Ø§Ú©Ø§ÙÛŒ! Ù†ÛŒØ§Ø² Ø¨Ù‡ ${totalPositionValue.toLocaleString()} ØªÙˆÙ…Ø§Ù†`;
                warningEl.style.display = 'block';
                resultEl.style.color = 'var(--danger)';
            } else {
                exposureEl.innerText = `Ø§Ø±Ø²Ø´ Ú©Ù„ Ù¾ÙˆØ²ÛŒØ´Ù†: ${totalPositionValue.toLocaleString()} ØªÙˆÙ…Ø§Ù† (${exposurePercent.toFixed(1)}% Ø³Ø±Ù…Ø§ÛŒÙ‡)`;
                exposureEl.style.display = 'block';
                resultEl.style.color = 'var(--accent)';
            }
        } else {
            resultEl.style.color = 'var(--accent)';
        }
    }
    function updateBasicStats(data) {
        let net = 0, wins = 0;
        let longCount = 0, shortCount = 0;
        
        data.forEach(t => {
            const val = parseMoney(t.profit);
            net += val;
            if (val > 0) wins++;
            if (t.type === 'Long') longCount++;
            else if (t.type === 'Short') shortCount++;
        });
        
        const wr = data.length ? ((wins/data.length)*100).toFixed(1) : 0;
        const pnlEl = document.getElementById('netPnl');
        pnlEl.innerText = net.toLocaleString();
        pnlEl.className = 'stat-value ' + (net >= 0 ? 'text-success' : 'text-danger');
        
        document.getElementById('winRate').innerText = wr + '%';
        document.getElementById('totalCount').innerText = data.length;
        
        const breakdownEl = document.getElementById('tradeTypeBreakdown');
        if (data.length > 0) {
            breakdownEl.style.display = 'block';
            document.getElementById('longCount').innerText = longCount;
            document.getElementById('shortCount').innerText = shortCount;
        } else {
            breakdownEl.style.display = 'none';
        }
    }
    function updateAdvancedStats(data) {
        if (data.length === 0) {
            ['valRR', 'valWinStreak', 'valLossStreak', 'valBestTrade', 'valWorstTrade'].forEach(id => document.getElementById(id).innerText = '-');
            return;
        }
        let totalWin = 0, winCount = 0, totalLoss = 0, lossCount = 0;
        let bestTrade = -Infinity, worstTrade = Infinity;
        
        data.forEach(t => {
            const val = parseMoney(t.profit);
            if (val > 0) {
                totalWin += val; winCount++;
                if (val > bestTrade) bestTrade = val;
            } else {
                totalLoss += val; lossCount++;
                if (val < worstTrade) worstTrade = val;
            }
        });
        
        const avgWin = winCount ? totalWin / winCount : 0;
        const avgLoss = lossCount ? Math.abs(totalLoss) / lossCount : 0;
        
        let rrRatio = 0;
        if (avgLoss > 0) rrRatio = avgWin / avgLoss;
        else if (avgWin > 0) rrRatio = 999;
        
        const rrEl = document.getElementById('valRR');
        rrEl.innerText = rrRatio === 999 ? 'âˆ' : rrRatio.toFixed(2);
        document.getElementById('boxRR').className = 'adv-stat-box ' + (rrRatio >= 1.5 ? 'good' : (rrRatio >= 1 ? 'neutral' : 'bad'));
        
        let currentWinStreak = 0, maxWinStreak = 0;
        let currentLossStreak = 0, maxLossStreak = 0;
        const sortedData = [...data].sort((a, b) => a.date.localeCompare(b.date) || a.id - b.id);
        
        sortedData.forEach(t => {
            const val = parseMoney(t.profit);
            if (val > 0) {
                currentWinStreak++; currentLossStreak = 0;
                if (currentWinStreak > maxWinStreak) maxWinStreak = currentWinStreak;
            } else {
                currentLossStreak++; currentWinStreak = 0;
                if (currentLossStreak > maxLossStreak) maxLossStreak = currentLossStreak;
            }
        });
        
        document.getElementById('valWinStreak').innerText = maxWinStreak;
        document.getElementById('valLossStreak').innerText = maxLossStreak;
        document.getElementById('valBestTrade').innerText = bestTrade === -Infinity ? 0 : bestTrade.toLocaleString();
        document.getElementById('valWorstTrade').innerText = worstTrade === Infinity ? 0 : worstTrade.toLocaleString();
    }
    // --- 4. Ù†Ù…ÙˆØ¯Ø§Ø± Ø§ØµÙ„ÛŒ ---
    function drawChart(data) {
        const svg = document.getElementById('equityChart');
        const tooltip = document.getElementById('tooltip');
        svg.innerHTML = '';
        
        // ØªØ¹Ø±ÛŒÙ Ú¯Ø±Ø§Ø¯ÛŒÙ†Øª
        const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
        defs.innerHTML = `
            <linearGradient id="goldGradient" x1="0" x2="0" y1="0" y2="1">
                <stop offset="0%" stop-color="#d4af37" stop-opacity="0.4"/>
                <stop offset="100%" stop-color="#d4af37" stop-opacity="0"/>
            </linearGradient>
        `;
        svg.appendChild(defs);
        if (data.length === 0) return;
        
        // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù†Ù‚Ø§Ø· Ù†Ù…ÙˆØ¯Ø§Ø± Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙÛŒÙ„ØªØ± Ø´Ø¯Ù‡
        const sortedData = [...data].sort((a, b) => a.date.localeCompare(b.date));
        const dailyPnl = {};
        sortedData.forEach(t => {
            if (!dailyPnl[t.date]) dailyPnl[t.date] = { pnl: 0, trades: [] };
            const val = parseMoney(t.profit);
            dailyPnl[t.date].pnl += val;
            dailyPnl[t.date].trades.push(t);
        });
        
        const dates = Object.keys(dailyPnl).sort((a, b) => a.localeCompare(b));
        let cumulativePnl = 0;
        const chartPoints = dates.map(date => {
            cumulativePnl += dailyPnl[date].pnl;
            return { date, value: cumulativePnl, trades: dailyPnl[date].trades };
        });
        
        const width = svg.clientWidth || 800;
        const height = svg.clientHeight || 350;
        const padding = 20;
        const values = chartPoints.map(p => p.value);
        const maxVal = Math.max(...values, 0);
        const minVal = Math.min(...values, 0);
        const range = maxVal - minVal || 100;
        
        const getX = (index) => padding + (index / (chartPoints.length - 1 || 1)) * (width - 2 * padding);
        const getY = (val) => height - padding - ((val - minVal) / range) * (height - 2 * padding);
        
        let pathD = `M ${getX(0)} ${getY(chartPoints[0].value)}`;
        let areaD = `M ${getX(0)} ${height - padding} L ${getX(0)} ${getY(chartPoints[0].value)}`;
        
        chartPoints.forEach((p, i) => {
            if (i === 0) return;
            const x = getX(i);
            const y = getY(p.value);
            pathD += ` L ${x} ${y}`;
            areaD += ` L ${x} ${y}`;
        });
        areaD += ` L ${getX(chartPoints.length - 1)} ${height - padding} Z`;
        
        const areaPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        areaPath.setAttribute("d", areaD);
        areaPath.setAttribute("class", "chart-area");
        svg.appendChild(areaPath);
        
        const linePath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        linePath.setAttribute("d", pathD);
        linePath.setAttribute("class", "chart-line");
        svg.appendChild(linePath);
        
        // Ø±Ø³Ù… Ù†Ù‚Ø§Ø· ØªØ¹Ø§Ù…Ù„ÛŒ
        chartPoints.forEach((p, i) => {
            const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            const cx = getX(i);
            const cy = getY(p.value);
            circle.setAttribute("cx", cx);
            circle.setAttribute("cy", cy);
            circle.setAttribute("r", 5);
            circle.setAttribute("fill", "#121212");
            circle.setAttribute("stroke", "#d4af37");
            circle.setAttribute("stroke-width", 2);
            circle.style.cursor = "pointer";
            circle.style.transition = "all 0.2s";
            circle.addEventListener('mouseenter', (e) => {
                circle.setAttribute("r", 8);
                circle.setAttribute("fill", "#d4af37");
                
                const dayTrades = p.trades;
                const dayPnl = dayTrades.reduce((sum, t) => sum + parseMoney(t.profit), 0);
                const pnlClass = dayPnl >= 0 ? 'text-success' : 'text-danger';
                const pnlSign = dayPnl >= 0 ? '+' : '';
                
                tooltip.style.display = 'block';
                tooltip.style.left = e.clientX + 15 + 'px';
                tooltip.style.top = e.clientY + 'px';
                
                // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ø¹Ú©Ø³ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± ØªÙˆÙ„ØªÛŒÙ¾
                let imageLinksHtml = '';
                dayTrades.forEach(t => {
                    if (t.image) {
                        imageLinksHtml += `<div class="tooltip-row"><span class="lightbox-img-link" onclick="openLightbox('${t.image}')">ğŸ“· Ù…Ø´Ø§Ù‡Ø¯Ù‡ ØªØµÙˆÛŒØ± (${t.symbol})</span></div>`;
                    }
                });

                tooltip.innerHTML = `
                    <span class="tooltip-title">${p.date}</span>
                    <div class="tooltip-row">
                        <span>ØªØ¹Ø¯Ø§Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§Øª:</span>
                        <span style="font-weight:bold">${dayTrades.length}</span>
                    </div>
                    <div class="tooltip-row">
                        <span>Ø³ÙˆØ¯/Ø¶Ø±Ø± Ø±ÙˆØ²:</span>
                        <span class="${pnlClass}" style="font-weight:bold">${pnlSign}${dayPnl.toLocaleString()}</span>
                    </div>
                    <div class="tooltip-row" style="margin-top:4px; padding-top:4px; border-top:1px solid #444; font-size:0.8rem; color:#aaa;">
                        <span>Ø³ÙˆØ¯ Ø§Ù†Ø¨Ø§Ø´ØªÙ‡:</span>
                        <span>${p.value.toLocaleString()}</span>
                    </div>
                    ${imageLinksHtml}
                `;
            });
            
            circle.addEventListener('mouseleave', () => {
                circle.setAttribute("r", 5);
                circle.setAttribute("fill", "#121212");
                tooltip.style.display = 'none';
            });
            
            svg.appendChild(circle);
        });
        
        if (minVal < 0 && maxVal > 0) {
            const zeroY = getY(0);
            const zeroLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
            zeroLine.setAttribute("x1", padding);
            zeroLine.setAttribute("y1", zeroY);
            zeroLine.setAttribute("x2", width - padding);
            zeroLine.setAttribute("y2", zeroY);
            zeroLine.setAttribute("stroke", "#555");
            zeroLine.setAttribute("stroke-dasharray", "4");
            svg.appendChild(zeroLine);
        }
    }
    /* --- NEW: ØªØ§Ø¨Ø¹ Ø±Ø³Ù… Ù†Ù…ÙˆØ¯Ø§Ø± Ø±ÙˆØ²Ø§Ù†Ù‡ --- */
    function drawDailyChart(date) {
        const svg = document.getElementById('dailyChartSvg');
        const tooltip = document.getElementById('tooltipDaily');
        svg.innerHTML = '';
        
        // ÙÛŒÙ„ØªØ± Ú©Ø±Ø¯Ù† Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø±ÙˆØ² Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡
        const dayTrades = trades.filter(t => t.date === date);
        
        if (dayTrades.length === 0) return;
        // Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¨Ø± Ø§Ø³Ø§Ø³ ID (ØªØ±ØªÛŒØ¨ Ø§Ù†Ø¬Ø§Ù… Ù…Ø¹Ø§Ù…Ù„Ù‡)
        dayTrades.sort((a, b) => a.id - b.id);
        let cumulativePnl = 0;
        const chartPoints = dayTrades.map((t, index) => {
            const val = parseMoney(t.profit);
            cumulativePnl += val;
            return { 
                index: index + 1, 
                value: cumulativePnl, 
                symbol: t.symbol,
                pnl: val,
                image: t.image // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ØªØµÙˆÛŒØ±
            };
        });
        const width = svg.clientWidth || 800;
        const height = svg.clientHeight || 250;
        const padding = 30;
        const values = chartPoints.map(p => p.value);
        const maxVal = Math.max(...values, 0);
        const minVal = Math.min(...values, 0);
        const range = maxVal - minVal || 100;
        const getX = (index) => padding + (index / (chartPoints.length - 1 || 1)) * (width - 2 * padding);
        const getY = (val) => height - padding - ((val - minVal) / range) * (height - 2 * padding);
        let pathD = `M ${getX(0)} ${getY(chartPoints[0].value)}`;
        
        chartPoints.forEach((p, i) => {
            if (i === 0) return;
            const x = getX(i);
            const y = getY(p.value);
            pathD += ` L ${x} ${y}`;
        });
        const linePath = document.createElementNS("http://www.w3.org/2000/svg", "path");
        linePath.setAttribute("d", pathD);
        linePath.setAttribute("class", "chart-line-daily");
        svg.appendChild(linePath);
        // Ø±Ø³Ù… Ù†Ù‚Ø§Ø· ØªØ¹Ø§Ù…Ù„ÛŒ
        chartPoints.forEach((p, i) => {
            const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            const cx = getX(i);
            const cy = getY(p.value);
            circle.setAttribute("cx", cx);
            circle.setAttribute("cy", cy);
            circle.setAttribute("r", 4);
            circle.setAttribute("fill", "#121212");
            circle.setAttribute("stroke", "#00c853");
            circle.setAttribute("stroke-width", 2);
            circle.style.cursor = "pointer";
            
            circle.addEventListener('mouseenter', (e) => {
                circle.setAttribute("r", 7);
                circle.setAttribute("fill", "#00c853");
                tooltip.style.display = 'block';
                tooltip.style.left = e.clientX + 15 + 'px';
                tooltip.style.top = e.clientY + 'px';
                
                const pnlClass = p.pnl >= 0 ? 'text-success' : 'text-danger';
                const pnlSign = p.pnl >= 0 ? '+' : '';
                
                // Ù„ÛŒÙ†Ú© Ø¨Ù‡ ØªØµÙˆÛŒØ± Ø¯Ø± ØªÙˆÙ„ØªÛŒÙ¾ Ø±ÙˆØ²Ø§Ù†Ù‡
                let imageHtml = '';
                if (p.image) {
                    imageHtml = `<div class="tooltip-row"><span class="lightbox-img-link" onclick="openLightbox('${p.image}')">ğŸ“· Ù…Ø´Ø§Ù‡Ø¯Ù‡ ØªØµÙˆÛŒØ±</span></div>`;
                }

                tooltip.innerHTML = `
                    <span class="tooltip-title">Ù…Ø¹Ø§Ù…Ù„Ù‡ #${p.index}: ${p.symbol}</span>
                    <div class="tooltip-row">
                        <span>Ø³ÙˆØ¯/Ø¶Ø±Ø±:</span>
                        <span class="${pnlClass}" style="font-weight:bold">${pnlSign}${p.pnl.toLocaleString()}</span>
                    </div>
                    <div class="tooltip-row" style="margin-top:4px; padding-top:4px; border-top:1px solid #444; font-size:0.8rem; color:#aaa;">
                        <span>Ø§Ù†Ø¨Ø§Ø´ØªÙ‡ Ø±ÙˆØ²:</span>
                        <span>${p.value.toLocaleString()}</span>
                    </div>
                    ${imageHtml}
                `;
            });
            
            circle.addEventListener('mouseleave', () => {
                circle.setAttribute("r", 4);
                circle.setAttribute("fill", "#121212");
                tooltip.style.display = 'none';
            });
            
            svg.appendChild(circle);
        });
        // Ø®Ø· ØµÙØ±
        if (minVal < 0 && maxVal > 0) {
            const zeroY = getY(0);
            const zeroLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
            zeroLine.setAttribute("x1", padding);
            zeroLine.setAttribute("y1", zeroY);
            zeroLine.setAttribute("x2", width - padding);
            zeroLine.setAttribute("y2", zeroY);
            zeroLine.setAttribute("stroke", "#555");
            zeroLine.setAttribute("stroke-dasharray", "4");
            svg.appendChild(zeroLine);
        }
    }
    // --- 5. ÙÛŒÙ„ØªØ±Ù‡Ø§ Ùˆ ØªÙ‚ÙˆÛŒÙ… ---
    function applyDateFilter() {
        const start = document.getElementById('startDate').value;
        const end = document.getElementById('endDate').value;
        filteredTrades = trades.filter(t => {
            let match = true;
            if (start && t.date < start) match = false;
            if (end && t.date > end) match = false;
            return match;
        });
        selectedDate = null;
        closeDailyChart(); // Ø¨Ø³ØªÙ† Ù†Ù…ÙˆØ¯Ø§Ø± Ø±ÙˆØ²Ø§Ù†Ù‡ Ù‡Ù†Ú¯Ø§Ù… ØªØºÛŒÛŒØ± ÙÛŒÙ„ØªØ± Ú©Ù„ÛŒ
        updateAll();
    }
    function resetFilters() {
        document.getElementById('startDate').value = '';
        document.getElementById('endDate').value = '';
        filteredTrades = [...trades];
        selectedDate = null;
        closeDailyChart();
        updateAll();
    }
    function renderCalendar() {
        const grid = document.getElementById('calendarGrid');
        grid.innerHTML = '';
        const daysData = {};
        filteredTrades.forEach(trade => {
            if (!daysData[trade.date]) daysData[trade.date] = { pnl: 0 };
            const val = parseMoney(trade.profit);
            daysData[trade.date].pnl += val;
        });
        const sortedDates = Object.keys(daysData).sort((a, b) => b.localeCompare(a));
        sortedDates.forEach(date => {
            const pnl = daysData[date].pnl;
            const isProfit = pnl >= 0;
            const card = document.createElement('div');
            card.style.width = "130px"
            card.className = `day-card ${isProfit ? 'bg-profit' : 'bg-loss'} ${selectedDate === date ? 'active' : ''}`;
            card.onclick = () => selectDate(date);
            card.innerHTML = `<div style="font-size:0.8rem; color:#ccc">${date}</div><div style="font-weight:bold; font-size:0.9rem" class="${isProfit ? 'text-profit' : 'text-loss'}">${isProfit ? '+' : ''}${pnl.toLocaleString()}</div>`;
            grid.appendChild(card);
        });
    }
    function selectDate(date) {
        if (selectedDate === date) {
            selectedDate = null; 
            closeDailyChart();
        } else {
            selectedDate = date;
            openDailyChart(date);
        }
        
        if (selectedDate) {
            const dayTrades = filteredTrades.filter(t => t.date === selectedDate);
            renderTable(dayTrades);
            updateBasicStats(dayTrades);
        } else {
            renderTable(filteredTrades);
            updateBasicStats(filteredTrades);
        }
        renderCalendar();
    }
    
    /* --- NEW: ØªÙˆØ§Ø¨Ø¹ Ú©Ù†ØªØ±Ù„ÛŒ Ù†Ù…ÙˆØ¯Ø§Ø± Ø±ÙˆØ²Ø§Ù†Ù‡ --- */
    function openDailyChart(date) {
        const card = document.getElementById('dailyChartCard');
        const label = document.getElementById('dailyChartDateLabel');
        label.innerText = date;
        card.classList.add('active');
        // Ú©Ù…ÛŒ ØªØ§Ø®ÛŒØ± Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø±Ù†Ø¯Ø± Ø´Ø¯Ù† Ú©Ø§Ù†ØªÛŒÙ†Ø± Ù‚Ø¨Ù„ Ø§Ø² Ø±Ø³Ù… SVG
        setTimeout(() => {
            drawDailyChart(date);
        }, 50);
    }
    
    function closeDailyChart() {
        const card = document.getElementById('dailyChartCard');
        card.classList.remove('active');
    }
    function resetCalendarFilter() {
        selectedDate = null;
        closeDailyChart();
        renderTable(filteredTrades);
        updateBasicStats(filteredTrades);
        renderCalendar();
    }
    // --- 6. Ø¬Ø¯ÙˆÙ„ ---
    function renderTable(data) {
        const tbody = document.getElementById('tableBody');
        const empty = document.getElementById('emptyState');
        tbody.innerHTML = '';
        if (data.length === 0) { empty.style.display = 'block'; return; }
        empty.style.display = 'none';
        data.forEach(t => {
            const tr = document.createElement('tr');
            const statusClass = t.status === 'profit' ? 'text-success' : 'text-danger';
            const typeClass = t.type === 'Long' ? 'badge-long' : 'badge-short';
            
            // Ø³Ù„ÙˆÙ„ ØªØµÙˆÛŒØ±
            let imageCell = '<td><span class="no-image">-</span></td>';
            if (t.image) {
                imageCell = `<td><img src="${t.image}" class="table-thumb" onclick="openLightbox('${t.image}')" alt="ØªØµÙˆÛŒØ±"></td>`;
            }

            tr.innerHTML = `
                ${imageCell}
                <td>${t.date}</td>
                <td style="font-weight:bold">${t.symbol}</td>
                <td><span class="badge ${typeClass}">${t.type}</span></td>
                <td>${(t.entry)}</td>
                <td>${(t.exit)}</td>
                <td>${t.quantity}</td>
                <td class="${statusClass}">${t.status === 'profit' ? 'Ø³ÙˆØ¯' : 'Ø¶Ø±Ø±'}</td>
                <td class="${statusClass}">${t.profit}</td>
                <td><button class="btn-delete" onclick="deleteTrade(${t.id})">Ã—</button></td>
            `;
            tbody.appendChild(tr);
        });
    }
    // --- Ù…Ø¯ÛŒØ±ÛŒØª ÙØ§ÛŒÙ„ ---
    function uploadData(input) {
        const file = input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const newTrades = JSON.parse(e.target.result);
                if (Array.isArray(newTrades)) {
                    trades = [...trades, ...newTrades];
                } else {
                    alert('ÙØ±Ù…Øª ÙØ§ÛŒÙ„ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª. ÙØ§ÛŒÙ„ Ø¨Ø§ÛŒØ¯ Ø´Ø§Ù…Ù„ ÛŒÚ© Ù„ÛŒØ³Øª (Ø¢Ø±Ø§ÛŒÙ‡) Ø§Ø² Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¨Ø§Ø´Ø¯.');
                    return;
                }
                filteredTrades = [...trades];
                localStorage.setItem('goldTrades', JSON.stringify(trades));
                resetFilters();
                alert(`ÙØ§ÛŒÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯. Ù…Ø¬Ù…ÙˆØ¹ ${newTrades.length} Ù…Ø¹Ø§Ù…Ù„Ù‡ Ø¨Ù‡ Ù„ÛŒØ³Øª Ø§Ø¶Ø§ÙÙ‡ Ú¯Ø±Ø¯ÛŒØ¯.`);
            } catch(err) {
                console.error(err);
                alert('Ø®Ø·Ø§ Ø¯Ø± Ø®ÙˆØ§Ù†Ø¯Ù† ÙØ§ÛŒÙ„. Ù„Ø·ÙØ§Ù‹ Ø§Ø² ØµØ­Øª ÙØ±Ù…Øª JSON Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø­Ø§ØµÙ„ Ú©Ù†ÛŒØ¯.');
            }
        };
        reader.readAsText(file);
        input.value = '';
    }
    function deleteTrade(id) {
        if(confirm('Ø­Ø°Ù Ø´ÙˆØ¯ØŸ')) {
            trades = trades.filter(t => t.id !== id);
            filteredTrades = filteredTrades.filter(t => t.id !== id);
            localStorage.setItem('goldTrades', JSON.stringify(trades));
            // Ø§Ú¯Ø± Ø±ÙˆØ²ÛŒ Ø¨Ø§Ø² Ø§Ø³ØªØŒ Ø¢Ù¾Ø¯ÛŒØª Ø´ÙˆØ¯
            if(selectedDate) {
                drawDailyChart(selectedDate);
            }
            updateAll();
        }
    }
    function clearData() {
        if(confirm('Ù‡Ù…Ù‡ Ù¾Ø§Ú© Ø´ÙˆØ¯ØŸ')) {
            trades = []; filteredTrades = [];
            localStorage.removeItem('goldTrades');
            closeDailyChart();
            updateAll();
        }
    }

    // --- ØªÙˆØ§Ø¨Ø¹ Ú©ÙˆÙ„â€ŒØ¢Ù¾ (Lightbox) ---
    function openLightbox(src) {
        const lightbox = document.getElementById('lightbox');
        const lightboxImg = document.getElementById('lightboxImg');
        lightbox.style.display = 'flex';
        lightboxImg.src = src;
    }

    function closeLightbox(event) {
        // Ø¨Ø³ØªÙ† ÙÙ‚Ø· Ø§Ú¯Ø± Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ Ø¶Ø±Ø¨Ø¯Ø± ÛŒØ§ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ú©Ù„ÛŒÚ© Ø´Ø¯ (Ù†Ù‡ Ø±ÙˆÛŒ Ø®ÙˆØ¯ Ø¹Ú©Ø³)
        if (event.target.id === 'lightbox' || event.target.classList.contains('close-lightbox')) {
            document.getElementById('lightbox').style.display = 'none';
        }
    }
    // Ù…Ø¯ÛŒØ±ÛŒØª ØªØºÛŒÛŒØ± Ø§Ø³ØªØ§ÛŒÙ„ Ù‡Ø¯Ø± Ù‡Ù†Ú¯Ø§Ù… Ø§Ø³Ú©Ø±ÙˆÙ„
window.addEventListener('scroll', () => {
    const header = document.getElementById('mainHeader');
    if (window.scrollY > 50) {
        header.classList.add('scrolled');
    } else {
        header.classList.remove('scrolled');
    }
});
</script>
</body>
</html>